<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üèÜ B√∫squeda del Tesoro IA Avanzada üß†</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Align to top */
      min-height: 100vh; /* Ensure it covers the full height */
    }
    .container {
      max-width: 700px; /* Increased max-width */
      width: 100%; /* Ensure it takes available width */
      margin: 20px auto; /* Center and add top/bottom margin */
      background: #ffffff;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
      text-align: center;
      position: relative; /* Needed for absolute positioning of timer/score */
    }
    h1, h2 {
      color: #4a2a8a;
      margin-bottom: 20px;
    }
    h1 {
        font-size: 2.5em;
    }
    h2 {
        font-size: 1.8em;
    }
     p {
         line-height: 1.6;
     }
     strong {
         color: #4a2a8a; /* Consistent color for strong text */
     }
    .section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    #start {
      text-align: center;
    }
    #start label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
    }
    #start input[type="text"] {
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1em;
      width: calc(100% - 24px); /* Adjust width considering padding */
    }
     #start button {
         margin-top: 10px;
     }
    button {
      background-color: #667eea;
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease, transform 0.1s ease;
    }
    button:hover {
      background-color: #5a67d8;
    }
    button:active {
      transform: scale(0.98);
    }
    button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
    }
    .hidden {
      display: none;
    }
    .question-area {
        margin-bottom: 25px;
        text-align: left;
        padding: 15px;
        border: 1px solid #eee;
        border-radius: 8px;
        background-color: #f9f9f9;
    }
     .question-area h3 {
         margin-top: 0;
         color: #764ba2;
         font-size: 1.3em;
         margin-bottom: 10px;
     }
    .options label {
        display: block;
        background-color: #eee;
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    .options label:hover {
        background-color: #ddd;
    }
     .options input[type="radio"] {
         margin-right: 10px;
         vertical-align: middle; /* Align radio button better */
     }
     .options label span {
         vertical-align: middle; /* Align text better */
     }

    .feedback {
        margin-top: 10px;
        padding: 10px;
        border-radius: 6px;
        font-weight: 600;
        text-align: center;
    }
    .feedback.correct {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
    }
    .feedback.incorrect {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
    }

    #timerDisplay, #scoreDisplay {
        position: absolute;
        top: 15px; /* Adjusted top position */
        font-size: 1.2em;
        font-weight: 700;
        color: #4a2a8a;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 8px 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        z-index: 10; /* Ensure it stays on top */
    }
    #timerDisplay {
        right: 15px; /* Position on the right */
    }
    #scoreDisplay {
        left: 15px; /* Position on the left */
    }

    #toolInfo {
        text-align: center;
        margin-bottom: 20px;
    }
    #toolInfo .tool-icon {
        font-size: 3em;
        display: block;
        margin-bottom: 10px;
    }
    #toolInfo .tool-title {
        margin: 0;
        color: #764ba2;
    }

    #end h2 {
        color: #4CAF50; /* Green color for success */
        font-size: 2.2em;
    }
     #end h2.time-out {
        color: #e74c3c; /* Red color for time out */
     }

    .result {
      font-size: 1.3em;
      margin-top: 20px;
      line-height: 1.6;
    }

     #treasure {
         margin-top: 30px;
         padding: 20px;
         border: 2px dashed #4a2a8a;
         border-radius: 12px;
         background-color: #e9e2f4;
         font-size: 1.1em;
         font-style: italic;
         color: #4a2a8a;
     }

    #ranking {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }
    #ranking h3 {
        color: #4a2a8a;
        margin-bottom: 15px;
    }
    #ranking ol {
        padding: 0;
        list-style: none; /* Remove default list style */
    }
    #ranking li {
        background-color: #f2f2f2;
        padding: 10px 15px;
        margin-bottom: 8px;
        border-radius: 6px;
        text-align: left;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
     #ranking li span:first-child {
         font-weight: 600;
         color: #555;
     }
     #ranking li span:last-child {
         font-weight: 700;
         color: #764ba2;
     }

    .end-buttons button {
        margin: 0 10px; /* Space between buttons */
    }


    /* Responsive adjustments */
    @media (max-width: 600px) {
        .container {
            padding: 20px;
            margin-top: 10px;
        }
        h1 {
            font-size: 2em;
        }
        h2 {
            font-size: 1.5em;
        }
        #start input[type="text"] {
             width: calc(100% - 20px);
             padding: 10px;
        }
        .options label {
            padding: 10px;
        }
         #timerDisplay, #scoreDisplay {
             font-size: 1em;
             padding: 6px 10px;
         }
         #timerDisplay { right: 5px; top: 5px; }
         #scoreDisplay { left: 5px; top: 5px; }

        #ranking li {
            flex-direction: column;
            align-items: flex-start;
        }
         #ranking li span:last-child {
             margin-top: 5px;
         }
         .end-buttons {
             display: flex;
             flex-direction: column;
             gap: 10px; /* Space between stacked buttons */
         }
         .end-buttons button {
             margin: 0; /* Remove horizontal margin for stacked buttons */
         }
    }
  </style>
</head>
<body>
<div class="container">
    <div id="timerDisplay" class="hidden">‚è≥ 05:00</div>
    <div id="scoreDisplay" class="hidden">üíØ 0 puntos</div>

  <h1>üèÜ B√∫squeda del Tesoro IA</h1>
  <p>¬°Responde correctamente las preguntas sobre herramientas de IA para encontrar el tesoro del conocimiento en menos de 5 minutos!</p>

  <div id="start">
    <label for="playerName">Escriba su nombre y apellido:</label>
    <input type="text" id="playerName" placeholder="Tu nombre √©pico" autocomplete="off" />
    <button id="startGameButton" onclick="startGame()">¬°Empezar!</button>
     <button id="resetRankingButton" class="hidden" onclick="resetRanking()">Borrar Ranking (Final de Juego)</button>
  </div>

  <div id="game" class="hidden section">
      <div id="toolInfo">
          <span class="tool-icon"></span>
          <h2 class="tool-title"></h2>
      </div>

    <div id="questionArea" class="question-area">
        <h3>Pregunta <span id="currentQuestionNumber">1</span> de <span id="totalQuestions"></span></h3>
        <p id="questionText"></p>
        <div id="options" class="options">
            <!-- Opciones de radio se insertar√°n aqu√≠ -->
        </div>
        <div id="feedback" class="feedback"></div>
         <button id="submitQButton" onclick="submitQuestion()">Responder</button>
    </div>

  </div>

  <div id="end" class="hidden section">
    <h2 id="endTitle"></h2>
    <div class="result" id="finalResult"></div>
     <div id="treasure" class="hidden">
         <h3>üíé El Tesoro Revelado üíé</h3>
         <p>La verdadera riqueza en el mundo de la IA no reside solo en la tecnolog√≠a, sino en tu capacidad para: <strong>seleccionar la herramienta adecuada para cada necesidad</strong> (sea Perplexity, Semantic Scholar, Elicit u otra), <strong>entender c√≥mo funcionan y sus l√≠mites</strong>, y <strong>utilizarlas con criterio y √©tica</strong>. ¬°Has completado la b√∫squeda y demostrado ser un explorador perspicaz de la IA!</p>
     </div>
    <div id="ranking">
        <h3>üëë Top Exploradores üëë</h3>
        <ol id="rankingList">
            <!-- Ranking items will be inserted here -->
        </ol>
    </div>
    <div class="end-buttons">
        <button onclick="retryGame()">Volver a realizar la b√∫squeda</button>
        <button onclick="restartGame()">Jugar con otro nombre</button>
    </div>
  </div>
</div>

<script>
const questions = [
  {
    tool: "Perplexity.ai",
    icon: "üß†",
    question: "¬øCu√°l herramienta IA es ideal para una exploraci√≥n r√°pida y generalista de un tema, ofreciendo respuestas en lenguaje natural con fuentes enlazadas, √∫til al inicio de una investigaci√≥n?",
    options: ["Elicit", "Semantic Scholar", "Perplexity AI"],
    correctOptionIndex: 2
  },
   {
    tool: "Semantic Scholar",
    icon: "üìö",
    question: "¬øQu√© herramienta est√° pensada como un buscador potente y especializado para localizar *exclusivamente* papers acad√©micos, identificar autores clave y analizar citas, siendo una fuente confiable para bibliograf√≠as?",
    options: ["Perplexity AI", "Semantic Scholar", "Elicit"],
    correctOptionIndex: 1
  },
   {
    tool: "Elicit",
    icon: "üî¨",
    question: "Si ya tienes varios papers sobre un tema y necesitas extraer datos clave, compararlos en tablas y sistematizar la evidencia sin leer cada uno completo, ¬øqu√© asistente de investigaci√≥n IA es el m√°s adecuado?",
    options: ["Perplexity AI", "Semantic Scholar", "Elicit"],
    correctOptionIndex: 2
  },
    {
    tool: "Perplexity.ai",
    icon: "üß†",
    question: "Una de estas herramientas funciona de manera muy conversacional, similar a un chatbot, permiti√©ndote 'charlar' con el tema y refinar tu b√∫squeda con seguimiento. ¬øCu√°l es?",
    options: ["Elicit", "Semantic Scholar", "Perplexity AI"],
    correctOptionIndex: 2
  },
    {
    tool: "Elicit",
    icon: "üî¨",
    question: "Seg√∫n las descripciones, ¬øqu√© herramienta es especialmente √∫til para la etapa de 'revisi√≥n de literatura' o para el dise√±o de investigaciones, gracias a su capacidad de estructurar informaci√≥n de m√∫ltiples estudios?",
    options: ["Semantic Scholar", "Perplexity AI", "Elicit"],
    correctOptionIndex: 2
  },
    {
    tool: "Semantic Scholar",
    icon: "üìö",
    question: "¬øQu√© herramienta destaca por su precisi√≥n en √°reas de alta especializaci√≥n acad√©mica como ciencia computacional, biomedicina y psicolog√≠a cognitiva, siendo ideal para armar el 'corpus bibliogr√°fico'?",
    options: ["Perplexity AI", "Semantic Scholar", "Elicit"],
    correctOptionIndex: 1
  },
     {
    tool: "Fiabilidad en IA",
    icon: "üß™",
    question: "Cuando una IA 'alucina', ¬øa qu√© se refiere principalmente?",
    options: ["Que genera im√°genes muy abstractas", "Que inventa datos, citas o informaci√≥n falsa que parece real", "Que tiene problemas para procesar audio"],
    correctOptionIndex: 1
  },
      {
    tool: "Fiabilidad en IA",
    icon: "‚ö†Ô∏è",
    question: "¬øCu√°l es uno de los 'Peligros comunes' al usar IA mencionados en cuanto a las referencias?",
    options: ["Que las referencias est√©n desordenadas alfab√©ticamente", "Que liste referencias falsas o incorrectas", "Que te haga comprar libros caros"],
    correctOptionIndex: 1
  },
       {
    tool: "Fiabilidad en IA",
    icon: "‚úÖ",
    question: "¬øCu√°l es un 'Criterio de evaluaci√≥n' fundamental para verificar la fiabilidad de la informaci√≥n generada por una IA?",
    options: ["Creer todo lo que dice porque es IA", "Verificaci√≥n cruzada con fuentes confiables", "Fijarse si el texto tiene muchos p√°rrafos"],
    correctOptionIndex: 1
  },
      {
    tool: "Rigor Acad√©mico",
    icon: "üìö",
    question: "El 'Rigor acad√©mico' no solo implica que un texto de IA 'suene bien'. ¬øQu√© elemento clave considera el rigor acad√©mico?",
    options: ["Usar muchas palabras dif√≠ciles", "Una estructura argumentativa clara y uso preciso de conceptos te√≥ricos", "Que sea lo m√°s corto posible"],
    correctOptionIndex: 1
  },
       {
    tool: "Rigor Acad√©mico",
    icon: "üß©",
    question: "¬øQu√© implica que un texto de IA tenga 'Referencias v√°lidas' en el contexto acad√©mico?",
    options: ["Que cite influencers populares", "Que cite autores reconocidos y fuentes de autoridad en el campo", "Que ponga links a videos virales"],
    correctOptionIndex: 1
  },
        {
    tool: "Estrategia Pedag√≥gica",
    icon: "üçé",
    question: "Para trabajar la evaluaci√≥n cr√≠tica de textos generados por IA, se sugiere comparar una respuesta de IA con un...",
    options: ["Un post de blog cualquiera", "Un art√≠culo acad√©mico real", "Un manual de instrucciones"],
    correctOptionIndex: 1
  },
         {
    tool: "Estrategia Pedag√≥gica",
    icon: "üîç",
    question: "¬øQu√© tipo de taller se propone para ense√±ar a los estudiantes a identificar errores fabricados por la IA?",
    options: ["Taller de cocina", "Taller de detecci√≥n de alucinaciones", "Taller de jardiner√≠a"],
    correctOptionIndex: 1
  },
          {
    tool: "Comparaci√≥n de Herramientas",
    icon: "ü§ù",
    question: "Si necesitas obtener una respuesta r√°pida a una pregunta general y ver de d√≥nde saca la informaci√≥n la IA (fuentes citadas), ¬øcu√°l de las tres herramientas es la m√°s directa para esta tarea?",
    options: ["Elicit", "Semantic Scholar", "Perplexity AI"],
    correctOptionIndex: 2
  },
           {
    tool: "Comparaci√≥n de Herramientas",
    icon: "üìä",
    question: "Si est√°s haciendo una revisi√≥n sistem√°tica y necesitas crear tablas comparativas de metodolog√≠as y resultados de varios estudios, ¬øqu√© herramienta es la m√°s adecuada para ayudarte a extraer y organizar esa informaci√≥n?",
    options: ["Perplexity AI", "Semantic Scholar", "Elicit"],
    correctOptionIndex: 2
  }
];

const totalTime = 300; // 5 minutos en segundos
const pointsPerCorrectAnswer = 20; // Points for each correct question
const rankingStorageKey = 'iaTreasureRanking'; // Key for localStorage

let currentQuestionIndex = 0;
let score = 0;
let timeLeft = totalTime;
let timerInterval;
let playerName = ""; // Player name will be stored here

// --- DOM Elements ---
const startScreen = document.getElementById("start");
const gameScreen = document.getElementById("game");
const endScreen = document.getElementById("end");
const playerNameInput = document.getElementById("playerName");
const startGameButton = document.getElementById("startGameButton"); // Get the start button
const resetRankingButton = document.getElementById("resetRankingButton"); // Get the reset button
const timerDisplay = document.getElementById("timerDisplay");
const scoreDisplay = document.getElementById("scoreDisplay");

const toolIcon = gameScreen.querySelector(".tool-icon");
const toolTitle = gameScreen.querySelector(".tool-title");
const questionArea = document.getElementById("questionArea");
const currentQuestionNumberSpan = document.getElementById("currentQuestionNumber");
const totalQuestionsSpan = document.getElementById("totalQuestions");
const questionTextElement = document.getElementById("questionText");
const optionsDiv = document.getElementById("options");
const feedbackElement = document.getElementById("feedback");
const submitQuestionButton = document.getElementById("submitQButton");

const endTitle = document.getElementById("endTitle");
const finalResultDiv = document.getElementById("finalResult");
const treasureDiv = document.getElementById("treasure");
const rankingListOl = document.getElementById("rankingList");


// --- Event Listener for "Final de Juego" ---
playerNameInput.addEventListener('input', function() {
    if (this.value.trim().toLowerCase() === 'final de juego') {
        resetRankingButton.classList.remove('hidden');
        startGameButton.disabled = true; // Disable start button when reset option is visible
    } else {
        resetRankingButton.classList.add('hidden');
        startGameButton.disabled = false; // Re-enable start button
    }
});


// --- Game Flow Functions ---
function startGame() {
  playerName = playerNameInput.value.trim();
  if (!playerName) {
    alert("¬°Necesitas un nombre (y apellido) para esta aventura!");
    return;
  }

  score = 0;
  currentQuestionIndex = 0;
  timeLeft = totalTime;
  totalQuestionsSpan.textContent = questions.length; // Set total questions display
  updateScoreDisplay();
  updateTimerDisplay();

  startScreen.classList.add("hidden");
  gameScreen.classList.remove("hidden");
  timerDisplay.classList.remove("hidden");
  scoreDisplay.classList.remove("hidden");

  startTimer();
  showQuestion();
}

function showQuestion() {
  // If all questions are answered, end the game successfully
  if (currentQuestionIndex >= questions.length) {
    endGame(false); // Game finished successfully
    return;
  }

  const questionData = questions[currentQuestionIndex];

  // Update UI for the current question
  currentQuestionNumberSpan.textContent = currentQuestionIndex + 1;
  toolIcon.textContent = questionData.icon;
  toolTitle.textContent = questionData.tool;
  questionTextElement.textContent = questionData.question;

  // Clear previous options and add new ones
  optionsDiv.innerHTML = "";
  questionData.options.forEach((option, i) => {
    optionsDiv.innerHTML += `
      <label>
        <input type="radio" name="answerOption" value="${i}" />
        <span>${option}</span>
      </label>
    `;
  });

  // Reset feedback and button state
  feedbackElement.textContent = "";
  feedbackElement.className = "feedback"; // Reset class
  submitQuestionButton.disabled = false;
  optionsDiv.querySelectorAll('input[name="answerOption"]').forEach(radio => radio.disabled = false); // Ensure options are enabled
}

function submitQuestion() {
  const selectedOption = optionsDiv.querySelector('input[name="answerOption"]:checked');

  if (!selectedOption) {
    alert("Por favor, selecciona una opci√≥n antes de responder.");
    return;
  }

  // Disable options and button to prevent multiple clicks
  optionsDiv.querySelectorAll('input[name="answerOption"]').forEach(radio => radio.disabled = true);
  submitQuestionButton.disabled = true;

  const userAnswerIndex = parseInt(selectedOption.value);
  const correctOptionIndex = questions[currentQuestionIndex].correctOptionIndex;

  if (userAnswerIndex === correctOptionIndex) {
    score += pointsPerCorrectAnswer;
    feedbackElement.textContent = `¬°Correcto! (+${pointsPerCorrectAnswer} puntos)`;
    feedbackElement.className = "feedback correct";
  } else {
    feedbackElement.textContent = `Incorrecto. La respuesta correcta era: "${questions[currentQuestionIndex].options[correctOptionIndex]}".`;
    feedbackElement.className = "feedback incorrect";
  }

  updateScoreDisplay();

  // Move to the next question after a short delay to show feedback
  setTimeout(() => {
      currentQuestionIndex++;
      showQuestion(); // This will either show the next question or end the game
  }, 1500); // Wait 1.5 seconds before moving on
}


function endGame(timeRanOut) {
  stopTimer();
  gameScreen.classList.add("hidden");
  timerDisplay.classList.add("hidden");
  scoreDisplay.classList.add("hidden");
  endScreen.classList.remove("hidden");

  const timeTaken = totalTime - timeLeft;

  if (timeRanOut) {
    endTitle.textContent = "üò¢ ¬°Tiempo Agotado!";
    endTitle.className = "time-out"; // Use class for red color
    finalResultDiv.innerHTML = `<p>‚è± ¬°Tiempo agotado, <strong>${playerName}</strong>!</p><p>No pudiste completar la b√∫squeda a tiempo.</p><p>Tu puntaje final es <strong>${score}</strong> puntos.</p>`;
    treasureDiv.classList.add("hidden"); // Hide treasure if time runs out

  } else {
    // Calculate bonus only if game finished before time ran out
    const bonus = Math.ceil(timeLeft / 10) * 2; // 2 points per 10 seconds left, rounded up
    score += bonus; // Add bonus to score *only for display and ranking saving*

    endTitle.textContent = "üéâ ¬°Tesoro de conocimiento encontrado!";
    endTitle.className = ""; // Remove time-out class
    finalResultDiv.innerHTML = `
        <p>¬°Felicitaciones, <strong>${playerName}</strong>!</p>
        <p>Has completado la b√∫squeda del tesoro en <strong>${timeTaken}</strong> segundos.</p>
        <p>Tu puntaje base (respuestas correctas): <strong>${score - bonus}</strong> puntos.</p>
        ${bonus > 0 ? `<p>üéÅ Bonus por rapidez: <strong>${bonus}</strong> puntos.</p>` : ''}
        <p>Tu puntaje final es: <strong>${score}</strong> puntos.</p>
    `;
    treasureDiv.classList.remove("hidden"); // Show treasure

    // Save result to ranking
    saveRanking({ name: playerName, score: score, time: timeTaken });
  }

  // Always display ranking at the end
  displayRanking();
}

function restartGame() {
    // Reset game state completely
    currentQuestionIndex = 0;
    score = 0;
    timeLeft = totalTime;
    playerNameInput.value = ""; // Clear name input
    playerName = ""; // Clear player name variable

    // Hide end screen, show start screen
    endScreen.classList.add("hidden");
    startScreen.classList.remove("hidden");

    // Clear any lingering feedback or input in the game screen
    feedbackElement.textContent = "";
    feedbackElement.className = "feedback";
    treasureDiv.classList.add("hidden"); // Hide treasure again
    resetRankingButton.classList.add('hidden'); // Hide reset button
    startGameButton.disabled = false; // Ensure start button is enabled

     // Re-enable button and options for the start of the next game
     submitQuestionButton.disabled = false;
     optionsDiv.querySelectorAll('input[name="answerOption"]').forEach(radio => radio.disabled = false);

     // Clear displayed ranking (will be re-displayed on next game end)
     rankingListOl.innerHTML = ''; // Optional: clear ranking display on full reset
}

function retryGame() {
    // Reset game state for the same player
    currentQuestionIndex = 0;
    score = 0;
    timeLeft = totalTime;

    // Update displays
    updateScoreDisplay();
    updateTimerDisplay();

    // Hide end screen, show game screen
    endScreen.classList.add("hidden");
    gameScreen.classList.remove("hidden");
    timerDisplay.classList.remove("hidden");
    scoreDisplay.classList.remove("hidden");

    // Start timer and show the first question
    startTimer();
    showQuestion();

     // Hide treasure if it was shown
     treasureDiv.classList.add("hidden");
}


// --- Timer Functions ---
function startTimer() {
  timerInterval = setInterval(updateTimer, 1000);
}

function updateTimer() {
  timeLeft--;
  updateTimerDisplay();

  if (timeLeft <= 0) {
    timeLeft = 0; // Ensure timer doesn't go negative
    updateTimerDisplay(); // Display 00:00
    endGame(true); // Time ran out
  }
}

function stopTimer() {
  clearInterval(timerInterval);
}

function updateTimerDisplay() {
  const minutes = Math.floor(timeLeft / 60);
  const seconds = timeLeft % 60;
  const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  timerDisplay.textContent = `‚è≥ ${formattedTime}`;
}

// --- Score Functions ---
function updateScoreDisplay() {
  scoreDisplay.textContent = `üíØ ${score} puntos`;
}

// --- Ranking Functions ---
function getRanking() {
    const rankingJson = localStorage.getItem(rankingStorageKey);
    return rankingJson ? JSON.parse(rankingJson) : [];
}

function saveRanking(result) {
    const ranking = getRanking();
    ranking.push(result);
    // Sort: higher score first, then shorter time for ties
    ranking.sort((a, b) => {
        if (b.score !== a.score) {
            return b.score - a.score; // Descending score
        }
        return a.time - b.time; // Ascending time
    });
    // Keep only top 10 results
    const topRanking = ranking.slice(0, 10);
    localStorage.setItem(rankingStorageKey, JSON.stringify(topRanking));
}

function displayRanking() {
    const ranking = getRanking();
    rankingListOl.innerHTML = ''; // Clear current list

    if (ranking.length === 0) {
        rankingListOl.innerHTML = '<li>A√∫n no hay resultados. ¬°S√© el primero!</li>';
        return;
    }

    ranking.forEach((item, index) => {
        const listItem = document.createElement('li');
        listItem.innerHTML = `
            <span>${index + 1}. ${item.name}</span>
            <span>${item.score} puntos (${item.time}s)</span>
        `;
        rankingListOl.appendChild(listItem);
    });
}

function resetRanking() {
    if (confirm("¬øEst√°s seguro de que quieres borrar todo el ranking? Esta acci√≥n no se puede deshacer.")) {
        localStorage.removeItem(rankingStorageKey);
        alert("Ranking borrado.");
        restartGame(); // Reset the game state and UI
        displayRanking(); // Show empty ranking immediately
    }
}


// Initial state setup
startScreen.classList.remove("hidden");
gameScreen.classList.add("hidden");
endScreen.classList.add("hidden");
timerDisplay.classList.add("hidden"); // Hide timer/score initially
scoreDisplay.classList.add("hidden");
treasureDiv.classList.add("hidden"); // Hide treasure initially
resetRankingButton.classList.add('hidden'); // Hide reset button initially

// Display ranking on load (even if empty)
displayRanking();

</script>
</body>
</html>
